$[ language swift ]
$[ domain SwiftClientAPI ]
$[ D summary, main "This template generates code to access the an server API from a Swift client." ]
$[ import "APIFunctions" ]
$[ import "../util/ReleaseFunctions" ]

$[ foreach module in space.modules if !module.isIncluded && module.hasPrimaryEntities ]
    $[ let className = module|domain:SwiftClientAPI|name|capitalize ]
    $[ file "" className "swift" ]
//
//  ${className}.swift
//
        $[ if module.hasDescription ]
//  ${module.description|wrap}
//
        $[/ if ]
//  Generated by Template: ${__template.name}
//

import Foundation

class ${className} {

    private let restServerBaseUrl : String

    init() {
        self.restServerBaseUrl = RestServerBaseUrl.defaultValue
    }
        $[ foreach entity in module.entities if !entity.isImplicit && !entity.isExtern ]
            $[ call CheckIfInReleasedRealm(entity: entity)->(isInReleasedRealm: isInReleasedRealm) ]
            $[ call CheckIfReleasedEntity(entity: entity)->(isReleasedEntity: isReleasedEntity) ]
            $[ if !isInReleasedRealm ]
                $[ continue ]
            $[/ if ]
            $[ call GetById(entity: entity) ]
            $[ call GetList(entity: entity, relationship: null) ]
            $[ foreach relationship in entity.relationships if relationship.isParent ]
                $[ let allow = relationship.isParent ]
                $[ if !allow && relationship.to.entity.hasRelationshipToEntityNamed(entity.name) ]
                    $[ let allow = true ]
                    $[ log info ]Adding API for getting list of ${entity.name} by ${relationship.to.entity.name}$[/ log ]
                $[/ if ]
                $[ if allow ]
                    $[ call GetList(entity: entity, relationship: relationship) ]
                $[/ if ]
            $[/ foreach ]
        $[/ foreach ]
}
    $[/ file ]
$[/ foreach ]